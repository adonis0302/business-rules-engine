/*! form 14-08-2014 */
var Validation;!function(a){!function(a){a[a.LessThan=0]="LessThan",a[a.LessThanEqual=1]="LessThanEqual",a[a.Equal=2]="Equal",a[a.NotEqual=3]="NotEqual",a[a.GreaterThanEqual=4]="GreaterThanEqual",a[a.GreaterThan=5]="GreaterThan"}(a.CompareOperator||(a.CompareOperator={}));a.CompareOperator}(Validation||(Validation={}));var Validation;!function(a){var b=function(){function a(){this.HasError=!0,this.ErrorMessage=""}return a}();a.Error=b;var c=function(){function a(a,b){this.Error=a,this.IsAsync=b}return Object.defineProperty(a.prototype,"HasError",{get:function(){return this.Error.HasError},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorMessage",{get:function(){return this.Error.ErrorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"TranslateArgs",{get:function(){return this.Error.TranslateArgs},enumerable:!0,configurable:!0}),a}();a.ValidationFailure=c;var d=function(){function a(a){this.Name=a}return Object.defineProperty(a.prototype,"Children",{get:function(){return[]},enumerable:!0,configurable:!0}),a.prototype.Add=function(){throw"Cannot add to ValidationResult to leaf node."},a.prototype.Remove=function(){throw"Cannot remove ValidationResult from leaf node."},Object.defineProperty(a.prototype,"HasErrorsDirty",{get:function(){return this.IsDirty&&this.HasErrors},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HasErrors",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorCount",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorMessage",{get:function(){return""},enumerable:!0,configurable:!0}),a}();a.ValidationResult=d;var e=function(){function a(a){this.Name=a,this.Children=[]}return a.prototype.AddFirst=function(a){this.Children.unshift(a)},a.prototype.Add=function(a){this.Children.push(a)},a.prototype.Remove=function(a){this.Children.splice(a,1)},Object.defineProperty(a.prototype,"HasErrorsDirty",{get:function(){return void 0!==this.Optional&&_.isFunction(this.Optional)&&this.Optional()?!1:_.some(this.Children,function(a){return a.HasErrorsDirty})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HasErrors",{get:function(){return void 0!==this.Optional&&_.isFunction(this.Optional)&&this.Optional()?!1:_.some(this.Children,function(a){return a.HasErrors})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorCount",{get:function(){return this.HasErrors?_.reduce(this.Children,function(a,b){return a+b.ErrorCount},0):0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorMessage",{get:function(){return this.HasErrors?_.reduce(this.Children,function(a,b){return a+b.ErrorMessage},""):""},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"TranslateArgs",{get:function(){if(!this.HasErrors)return[];var a=[];return _.each(this.Children,function(b){a=a.concat(b.TranslateArgs)}),a},enumerable:!0,configurable:!0}),a.prototype.LogErrors=function(a){void 0===a&&(a="Output"),console.log("---------------\n"),console.log("--- "+a+" ----\n"),console.log("---------------\n"),this.traverse(this,1),console.log("\n\n\n")},Object.defineProperty(a.prototype,"Errors",{get:function(){var a={};return _.each(this.Children,function(b){a[b.Name]=b}),a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"FlattenErros",{get:function(){var a=[];return this.flattenErrors(this,a),a},enumerable:!0,configurable:!0}),a.prototype.SetDirty=function(){this.SetDirtyEx(this,!0)},a.prototype.SetPristine=function(){this.SetDirtyEx(this,!1)},a.prototype.SetDirtyEx=function(a,b){if(0===a.Children.length)a.IsDirty=b;else for(var c=0,d=a.Children.length;d>c;c++)this.SetDirtyEx(a.Children[c],b)},a.prototype.flattenErrors=function(a,b){if(0===a.Children.length)a.HasErrors&&b.push(a);else for(var c=0,d=a.Children.length;d>c;c++)a.Children[c].HasErrors&&this.flattenErrors(a.Children[c],b)},a.prototype.traverse=function(a,b){console.log(Array(b++).join("--")+a.Name+" ("+a.ErrorMessage+")\n\r");for(var c=0,d=a.Children.length;d>c;c++)this.traverse(a.Children[c],b)},a}();a.CompositeValidationResult=e}(Validation||(Validation={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Validation;!function(a){var b=function(){function a(){this.Validators={},this.AbstractValidators={},this.ValidationFunctions={},this.ForList=!1}return a.prototype.RuleFor=function(a,b){void 0==this.Validators[a]&&(this.Validators[a]=[]),this.Validators[a].push(b)},a.prototype.ValidationFor=function(a,b){void 0==this.ValidationFunctions[a]&&(this.ValidationFunctions[a]=[]),this.ValidationFunctions[a].push(b)},a.prototype.Validation=function(a){if(void 0===a.Name)throw"argument must have property Name";this.ValidationFor(a.Name,a)},a.prototype.ValidatorFor=function(a,b,c){b.ForList=c,this.AbstractValidators[a]=b},a.prototype.CreateAbstractRule=function(a){return new c(a,this)},a.prototype.CreateAbstractListRule=function(a){return new d(a,this)},a.prototype.CreateRule=function(a){return new c(a,this)},a}();a.AbstractValidator=b;var c=function(){function b(b,c,d){this.Name=b,this.validator=c,this.Rules={},this.Validators={},this.Children={},this.ForList=!1,this.ValidationResult=new a.CompositeValidationResult(this.Name),d||(_.each(this.validator.Validators,function(a,b){this.createRuleFor(b),_.each(a,function(a){this.Rules[b].AddValidator(a)},this)},this),_.each(this.validator.ValidationFunctions,function(a){_.each(a,function(a){var b=this.Validators[a.Name];void 0==b&&(b=new i(a.Name,a.ValidationFce,a.AsyncValidationFce),this.Validators[a.Name]=b,this.ValidationResult.Add(b))},this)},this),this.addChildren())}return b.prototype.addChildren=function(){_.each(this.validator.AbstractValidators,function(a,b){var c;c=a.ForList?a.CreateAbstractListRule(b):a.CreateAbstractRule(b),this.Children[b]=c,this.ValidationResult.Add(c.ValidationResult)},this)},b.prototype.SetOptional=function(a){this.ValidationResult.Optional=a},b.prototype.createRuleFor=function(a){var b=new h(a);this.Rules[a]=b,this.ValidationResult.Add(b)},b.prototype.Validate=function(a){_.each(this.Children,function(b,c){void 0===a[c]&&(a[c]={}),b.Validate(a[c])},this);for(var b in this.Rules){var c=this.Rules[b];c.Validate(new e(b,a))}return _.each(this.validator.ValidationFunctions,function(b){_.each(b,function(b){var c=this.Validators[b.Name];void 0!=c&&c.Validate(a)},this)},this),this.ValidationResult},b.prototype.ValidateAsync=function(a){var b=Q.defer(),c=[];_.each(this.Children,function(b,d){c.push(b.ValidateAsync(a[d]))},this);for(var d in this.Rules){var f=this.Rules[d];c.push(f.ValidateAsync(new e(d,a)))}_.each(this.validator.ValidationFunctions,function(b){_.each(b,function(b){var d=this.Validators[b.Name];void 0!=d&&c.push(d.ValidateAsync(a))},this)},this);var g=this;return Q.all(c).then(function(){b.resolve(g.ValidationResult)}),b.promise},b.prototype.ValidateAll=function(a){return this.Validate(a),this.ValidateAsync(a)},b.prototype.ValidateProperty=function(a,b){var c=this.Children[b];void 0!=c&&c.Validate(a[b]);var d=this.Rules[b];if(void 0!=d){var f=new e(b,a);d.Validate(f),d.ValidateAsync(f)}var g=this.validator.ValidationFunctions[b];void 0!=g&&_.each(g,function(b){var c=this.Validators[b.Name];void 0!=c&&c.Validate(a)},this)},b}(),d=function(a){function b(b,c){a.call(this,b,c,!0),this.Name=b,this.validator=c}return __extends(b,a),b.prototype.Validate=function(a){this.NotifyListChanged(a);for(var b=0;b!=a.length;b++){var c=this.getValidationRule(b);void 0!=c&&c.Validate(a[b])}return this.ValidationResult},b.prototype.ValidateAsync=function(a){var b=Q.defer(),c=[];this.NotifyListChanged(a);for(var d=0;d!=a.length;d++){var e=this.getValidationRule(d);void 0!=e&&c.push(e.ValidateAsync(a[d]))}var f=this;return Q.all(c).then(function(){b.resolve(f.ValidationResult)}),b.promise},b.prototype.getValidationRule=function(a){var b=this.getIndexedKey(a);return this.Children[b]},b.prototype.getIndexedKey=function(a){return this.Name+a.toString()},b.prototype.NotifyListChanged=function(a){for(var b=0;b!=a.length;b++){var c=this.getValidationRule(b);if(void 0==c){var d=this.getIndexedKey(b);c=this.validator.CreateAbstractRule(d),this.Children[d]=c,this.ValidationResult.Add(c.ValidationResult)}}},b}(c),e=function(){function a(a,b){this.Key=a,this.Data=b}return Object.defineProperty(a.prototype,"Value",{get:function(){return this.Data[this.Key]},enumerable:!0,configurable:!0}),a}(),f=function(){function a(){}return a.GetValidationMessage=function(b){var c=a.ValidationMessages[b.tagName];return void 0!=c&&""!=c&&_.isString(c)||(c=a.customMsg),g.format(c,b)},a.customMsg="Please, fix the field.",a.defaultMessages={required:"This field is required.",remote:"Please fix the field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date ( ISO ).",number:"Please enter a valid number.",digits:"Please enter only digits.",signedDigits:"Please enter only signed digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:"Please enter no more than {MaxLength} characters.",minlength:"Please enter at least {MinLength} characters.",rangelength:"Please enter a value between {MinLength} and {MaxLength} characters long.",range:"Please enter a value between {Min} and {Max}.",max:"Please enter a value less than or equal to {Max}.",min:"Please enter a value greater than or equal to {Min}.",step:"Please enter a value with step {Step}.",contains:"Please enter a value from list of values. Attempted value '{AttemptedValue}'.",mask:"Please enter a value corresponding with {Mask}.",custom:a.customMsg},a.ValidationMessages=a.defaultMessages,a}(),g=function(){function a(){}return a.format=function(a,b){var c=a;for(var d in b){var e=new RegExp("\\{"+d+"\\}","gi");c=c.replace(e,b[d])}return c},a}(),h=function(b){function c(a,c){b.call(this,a),this.Name=a,this.Validators={},this.ValidationFailures={};for(var d in c)this.AddValidator(c[d])}return __extends(c,b),c.prototype.AddValidator=function(b){this.Validators[b.tagName]=b,this.ValidationFailures[b.tagName]=new a.ValidationFailure(new a.Error,!!b.isAsync)},Object.defineProperty(c.prototype,"Errors",{get:function(){return this.ValidationFailures},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"HasErrors",{get:function(){return void 0!=this.Optional&&_.isFunction(this.Optional)&&this.Optional()?!1:_.some(_.values(this.Errors),function(a){return a.HasError})},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ErrorCount",{get:function(){return this.HasErrors?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ErrorMessage",{get:function(){return this.HasErrors?_.reduce(_.values(this.Errors),function(a,b){return a+b.ErrorMessage},""):""},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"TranslateArgs",{get:function(){if(!this.HasErrors)return[];var a=[];return _.each(_.values(this.Errors),function(b){b.HasError&&a.push(b.Error.TranslateArgs)}),a},enumerable:!0,configurable:!0}),c.prototype.Validate=function(a){try{return this.ValidateEx(a.Value)}catch(b){throw console.log("Exception occurred when checking element "+a.Key+".",b),b}},c.prototype.ValidateEx=function(a){var b=0,c=!1;for(var d in this.ValidationFailures){var e=this.ValidationFailures[d];if(!e.IsAsync){var g=this.Validators[d];try{var h=0;if(c&&h>b)e.Error.HasError=!1;else{var i=void 0!==a&&null!==a||"required"==g.tagName?!g.isAcceptable(a):!1;e.Error.HasError=i,e.Error.TranslateArgs={TranslateId:g.tagName,MessageArgs:_.extend(g,{AttemptedValue:a}),CustomMessage:g.customMessage},e.Error.ErrorMessage=i?f.GetValidationMessage(e.Error.TranslateArgs.MessageArgs):"",c=i,b=h}}catch(j){throw console.log("Exception occurred when checking element'"+g.tagName+"' method.",j),j}}}return _.filter(this.ValidationFailures,function(a){return!a.IsAsync})},c.prototype.ValidateAsync=function(a){return this.ValidateAsyncEx(a.Value)},c.prototype.ValidateAsyncEx=function(a){var b=Q.defer(),c=[];for(var d in this.ValidationFailures){var e=this.ValidationFailures[d];if(e.IsAsync){var g=this.Validators[d];try{var h=void 0!==a&&null!==a||"required"==g.tagName?g.isAcceptable(a):Q.when(!0);h.then(function(b){var c=!b;e.Error.HasError=c,e.Error.TranslateArgs={TranslateId:g.tagName,MessageArgs:_.extend(g,{AttemptedValue:a})},e.Error.ErrorMessage=c?f.GetValidationMessage(e.Error.TranslateArgs.MessageArgs):""}),c.push(h)}catch(i){throw console.log("Exception occurred when checking element'"+g.tagName+"' method.",i),i}}}var j=this;return Q.all(c).then(function(){b.resolve(_.filter(j.ValidationFailures,function(a){return a.IsAsync}))}),b.promise},c}(a.ValidationResult),i=function(b){function c(c,d,e){b.call(this,c),this.Name=c,this.ValidateFce=d,this.AsyncValidationFce=e,this.Error=new a.Error,this.ValidationFailures={},this.ValidationFailures[this.Name]=new a.ValidationFailure(this.Error,!1)}return __extends(c,b),c.prototype.Validate=function(a){return void 0!=this.ValidateFce&&this.ValidateFce.bind(a)(this.Error),this.ValidationFailures[this.Name]},c.prototype.ValidateAsync=function(a){var b=Q.defer();if(void 0==this.AsyncValidationFce)b.resolve(this.ValidationFailures[this.Name]);else{var c=this;this.AsyncValidationFce.bind(a)(this.Error).then(function(){b.resolve(c.ValidationFailures[c.Name])})}return b.promise},Object.defineProperty(c.prototype,"HasError",{get:function(){return this.HasErrors},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"Errors",{get:function(){return this.ValidationFailures},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"HasErrors",{get:function(){return void 0!=this.Optional&&_.isFunction(this.Optional)&&this.Optional()?!1:this.Error.HasError},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ErrorCount",{get:function(){return this.HasErrors?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"ErrorMessage",{get:function(){return this.HasErrors?this.Error.ErrorMessage:""},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"TranslateArgs",{get:function(){if(!this.HasErrors)return[];var a=[];return a.push(this.Error.TranslateArgs),a},enumerable:!0,configurable:!0}),c}(a.ValidationResult)}(Validation||(Validation={}));