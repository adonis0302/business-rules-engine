/*! business-rules-engine, v.1.2.1 11-10-2014 */
var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Validation;!function(a){!function(a){a[a.LessThan=0]="LessThan",a[a.LessThanEqual=1]="LessThanEqual",a[a.Equal=2]="Equal",a[a.NotEqual=3]="NotEqual",a[a.GreaterThanEqual=4]="GreaterThanEqual",a[a.GreaterThan=5]="GreaterThan"}(a.CompareOperator||(a.CompareOperator={}));var b=(a.CompareOperator,function(){function a(){this.HasError=!1,this.ErrorMessage=""}return a}());a.Error=b;var c=function(){function a(a,b){this.Error=a,this.IsAsync=b}return Object.defineProperty(a.prototype,"HasError",{get:function(){return this.Error.HasError},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorMessage",{get:function(){return this.Error.ErrorMessage},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"TranslateArgs",{get:function(){return this.Error.TranslateArgs},enumerable:!0,configurable:!0}),a}();a.ValidationFailure=c;var d=function(){function a(a){this.Name=a,this.ErrorsChanged=new Utils.Signal}return Object.defineProperty(a.prototype,"Children",{get:function(){return[]},enumerable:!0,configurable:!0}),a.prototype.Add=function(){throw"Cannot add to ValidationResult to leaf node."},a.prototype.Remove=function(){throw"Cannot remove ValidationResult from leaf node."},a.prototype.DispatchErrorsChanged=function(){void 0!==this.ErrorsChanged&&this.ErrorsChanged.dispatch(this)},Object.defineProperty(a.prototype,"HasErrorsDirty",{get:function(){return this.IsDirty&&this.HasErrors},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HasErrors",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorCount",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorMessage",{get:function(){return""},enumerable:!0,configurable:!0}),a}();a.ValidationResult=d;var e=function(){function a(a){this.Name=a,this.Children=[],this.ErrorsChanged=new Utils.Signal}return a.prototype.AddFirst=function(a){this.Children.unshift(a)},a.prototype.Add=function(a){this.Children.push(a)},a.prototype.Remove=function(a){this.Children.splice(a,1)},a.prototype.Clear=function(){this.Children.splice(0,this.Children.length)},Object.defineProperty(a.prototype,"HasErrorsDirty",{get:function(){return void 0!==this.Optional&&_.isFunction(this.Optional)&&this.Optional()?!1:_.some(this.Children,function(a){return a.HasErrorsDirty})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"HasErrors",{get:function(){return void 0!==this.Optional&&_.isFunction(this.Optional)&&this.Optional()?!1:_.some(this.Children,function(a){return a.HasErrors})},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorCount",{get:function(){return this.HasErrors?_.reduce(this.Children,function(a,b){return a+b.ErrorCount},0):0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"ErrorMessage",{get:function(){return this.HasErrors?_.reduce(this.Children,function(a,b){return a+b.ErrorMessage},""):""},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"TranslateArgs",{get:function(){if(!this.HasErrors)return[];var a=[];return _.each(this.Children,function(b){a=a.concat(b.TranslateArgs)}),a},enumerable:!0,configurable:!0}),a.prototype.LogErrors=function(a){void 0===a&&(a="Output"),console.log("---------------\n"),console.log("--- "+a+" ----\n"),console.log("---------------\n"),this.traverse(this,1),console.log("\n\n\n")},Object.defineProperty(a.prototype,"Errors",{get:function(){var a={};return _.each(this.Children,function(b){a[b.Name]=b}),a},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"FlattenErros",{get:function(){var a=[];return this.flattenErrors(this,a),a},enumerable:!0,configurable:!0}),a.prototype.SetDirty=function(){this.SetDirtyEx(this,!0)},a.prototype.SetPristine=function(){this.SetDirtyEx(this,!1)},a.prototype.SetDirtyEx=function(a,b){if(0===a.Children.length)a.IsDirty=b;else for(var c=0,d=a.Children.length;d>c;c++)this.SetDirtyEx(a.Children[c],b)},a.prototype.flattenErrors=function(a,b){if(0===a.Children.length)a.HasErrors&&b.push(a);else for(var c=0,d=a.Children.length;d>c;c++)a.Children[c].HasErrors&&this.flattenErrors(a.Children[c],b)},a.prototype.traverse=function(a,b){console.log(Array(b++).join("--")+a.Name+" ("+a.ErrorMessage+")\n\r");for(var c=0,d=a.Children.length;d>c;c++)this.traverse(a.Children[c],b)},a}();a.CompositeValidationResult=e;var f=function(a){function b(b,c){a.call(this,b.Name),this.Composite=b,this.PropRule=c}return __extends(b,a),Object.defineProperty(b.prototype,"Children",{get:function(){return this.Composite.Children},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ValidationFailures",{get:function(){return this.PropRule.ValidationFailures},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"HasErrorsDirty",{get:function(){return this.Composite.HasErrorsDirty?!0:void 0!==this.PropRule&&this.PropRule.HasErrorsDirty?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"HasErrors",{get:function(){return this.Composite.HasErrors?!0:void 0!==this.PropRule&&this.PropRule.HasErrors?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ErrorCount",{get:function(){return this.Composite.HasErrors||void 0===this.PropRule||this.PropRule.HasErrors?this.Composite.ErrorCount+(void 0!==this.PropRule?this.PropRule.ErrorCount:0):0},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"ErrorMessage",{get:function(){return this.Composite.HasErrors||void 0===this.PropRule||this.PropRule.HasErrors?void(this.Composite.ErrorMessage+this.PropRule!==void 0?this.PropRule.ErrorMessage:""):""},enumerable:!0,configurable:!0}),b}(e),g=function(){function a(){this.Validators={},this.AbstractValidators={},this.ValidationFunctions={},this.ForList=!1}return a.prototype.RuleFor=function(a,b){void 0===this.Validators[a]&&(this.Validators[a]=[]),this.Validators[a].push(b)},a.prototype.ValidationFor=function(a,b){void 0===this.ValidationFunctions[a]&&(this.ValidationFunctions[a]=[]),this.ValidationFunctions[a].push(b)},a.prototype.Validation=function(a){if(void 0===a.Name)throw"argument must have property Name";this.ValidationFor(a.Name,a)},a.prototype.ValidatorFor=function(a,b,c){b.ForList=c,this.AbstractValidators[a]=b},a.prototype.CreateAbstractRule=function(a){return new h(a,this)},a.prototype.CreateAbstractListRule=function(a){return new j(a,this)},a.prototype.CreateRule=function(a){return new h(a,this)},a}();a.AbstractValidator=g;var h=function(){function a(a,b,c){this.Name=a,this.validator=b,this.ForList=c,this.Rules={},this.Validators={},this.Children={},this.ValidationResultVisitor=new i(new e(this.Name)),this.ForList||(_.each(this.validator.Validators,function(a,b){this.createRuleFor(b),_.each(a,function(a){this.Rules[b].AddValidator(a)},this)},this),_.each(this.validator.ValidationFunctions,function(a){_.each(a,function(a){var b=this.Validators[a.Name];void 0===b&&(b=new n(a.Name,a.ValidationFce,a.AsyncValidationFce),this.Validators[a.Name]=b,b.AcceptVisitor(this.ValidationResultVisitor))},this)},this),this.addChildren())}return Object.defineProperty(a.prototype,"ValidationResult",{get:function(){return this.ValidationResultVisitor.ValidationResult},set:function(a){this.ValidationResultVisitor.ValidationResult=a},enumerable:!0,configurable:!0}),a.prototype.AcceptVisitor=function(a){a.AddValidator(this)},a.prototype.addChildren=function(){_.each(this.validator.AbstractValidators,function(a,b){var c;c=a.ForList?a.CreateAbstractListRule(b):a.CreateAbstractRule(b),this.Children[b]=c,c.AcceptVisitor(this.ValidationResultVisitor)},this)},a.prototype.SetOptional=function(a){this.ValidationResult.Optional=a,_.each(this.Rules,function(b){b.Optional=a}),_.each(this.Validators,function(b){b.Optional=a}),_.each(this.Children,function(b){b.SetOptional(a)})},a.prototype.createRuleFor=function(a){var b=new m(a);this.Rules[a]=b,b.AcceptVisitor(this.ValidationResultVisitor)},a.prototype.Validate=function(a){_.each(this.Children,function(b,c){void 0===a[c]&&(a[c]=b.ForList?[]:{}),b.Validate(a[c])},this);for(var b in this.Rules){var c=this.Rules[b];c.Validate(new k(b,a))}return _.each(this.validator.ValidationFunctions,function(b){_.each(b,function(b){var c=this.Validators[b.Name];void 0!==c&&c.Validate(a)},this)},this),this.ValidationResult},a.prototype.ValidateAsync=function(a){var b=Q.defer(),c=[];_.each(this.Children,function(b,d){c.push(b.ValidateAsync(a[d]))},this);for(var d in this.Rules){var e=this.Rules[d];c.push(e.ValidateAsync(new k(d,a)))}_.each(this.validator.ValidationFunctions,function(b){_.each(b,function(b){var d=this.Validators[b.Name];void 0!==d&&c.push(d.ValidateAsync(a))},this)},this);var f=this;return Q.all(c).then(function(){b.resolve(f.ValidationResult)}),b.promise},a.prototype.ValidateAll=function(a){return this.Validate(a),this.ValidateAsync(a)},a.prototype.ValidateProperty=function(a,b){var c=this.Children[b];void 0!==c&&c.Validate(a[b]);var d=this.Rules[b];if(void 0!==d){var e=new k(b,a);d.Validate(e),d.ValidateAsync(e)}var f=this.validator.ValidationFunctions[b];void 0!==f&&_.each(f,function(b){var c=this.Validators[b.Name];void 0!==c&&c.Validate(a)},this)},a.id=0,a}(),i=function(){function a(a){this.ValidationResult=a}return a.prototype.AddRule=function(a){this.ValidationResult.Add(a)},a.prototype.AddValidator=function(a){var b=_.find(this.ValidationResult.Children,function(b){return b.Name===a.ValidationResult.Name});this.ValidationResult.Add(void 0!==b?new f(a.ValidationResult,b):a.ValidationResult)},a.prototype.AddValidation=function(a){this.ValidationResult.Add(a)},a}(),j=function(a){function b(b,c){a.call(this,b,c,!0),this.Name=b,this.validator=c,this.RowsMap=new HashMap}return __extends(b,a),b.prototype.Validate=function(a){this.RefreshRows(a);for(var b=0;b!=a.length;b++){var c=this.RowsMap.get(a[b]);void 0!==c&&c.Validate(a[b])}return this.ValidationResult},b.prototype.ValidateAsync=function(a){var b=Q.defer(),c=[];this.RefreshRows(a);for(var d=0;d!=a.length;d++){var e=this.RowsMap.get(a[d]);void 0!==e&&c.push(e.ValidateAsync(a[d]))}var f=this;return Q.all(c).then(function(){b.resolve(f.ValidationResult)}),b.promise},Object.defineProperty(b.prototype,"Rows",{get:function(){return this.RowsMap.values()},enumerable:!0,configurable:!0}),b.prototype.RefreshRows=function(a){this.refreshList(a)},b.prototype.ClearRows=function(a){var b=_.difference(this.RowsMap.keys(),a);_.each(b,function(a){this.has(a)&&this.remove(a)},this.RowsMap)},b.prototype.ClearValidationResult=function(a){this.ClearRows(a);for(var b=_.map(this.RowsMap.values(),function(a){return a.ValidationResult}),c=this.ValidationResult.Children.length-1;c>=0;c--){var d=this.ValidationResult.Children[c];void 0!==d&&-1===b.indexOf(d)&&this.ValidationResult.Remove(c)}},b.prototype.getValidationRule=function(a,b){void 0===b&&(b="Row");var c;return this.RowsMap.has(a)?c=this.RowsMap.get(a):(c=this.validator.CreateAbstractRule(b),this.ValidationResult.Add(c.ValidationResult),this.RowsMap.set(a,c)),c},b.prototype.refreshList=function(a){this.ClearValidationResult(a),_.each(a,function(a){this.getValidationRule(a)},this)},b}(h),k=function(){function a(a,b){this.Key=a,this.Data=b}return Object.defineProperty(a.prototype,"Value",{get:function(){return this.Data[this.Key]},enumerable:!0,configurable:!0}),a}(),l=function(){function a(){}return a.GetValidationMessage=function(b){var c=a.ValidationMessages[b.tagName];return void 0!==c&&""!==c&&_.isString(c)||(c=a.customMsg),Utils.StringFce.format(c,b)},a.customMsg="Please, fix the field.",a.defaultMessages={required:"This field is required.",remote:"Please fix the field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date ( ISO ).",number:"Please enter a valid number.",digits:"Please enter only digits.",signedDigits:"Please enter only signed digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:"Please enter no more than {MaxLength} characters.",minlength:"Please enter at least {MinLength} characters.",rangelength:"Please enter a value between {MinLength} and {MaxLength} characters long.",range:"Please enter a value between {Min} and {Max}.",max:"Please enter a value less than or equal to {Max}.",min:"Please enter a value greater than or equal to {Min}.",step:"Please enter a value with step {Step}.",contains:"Please enter a value from list of values. Attempted value '{AttemptedValue}'.",mask:"Please enter a value corresponding with {Mask}.",minItems:"Please enter at least {Min} items.",maxItems:"Please enter no more than {Max} items.",uniqItems:"Please enter unique items.","enum":"Please enter a value from list of permitted values.",type:"Please enter a value of type '{Type}'.",multipleOf:"Please enter a value that is multiple of {Divider}.",custom:a.customMsg},a.ValidationMessages=a.defaultMessages,a}();a.MessageLocalization=l;var m=function(a){function d(b,c){a.call(this,b),this.Name=b,this.Validators={},this.ValidationFailures={};for(var d in c)this.AddValidator(c[d])}return __extends(d,a),d.prototype.AcceptVisitor=function(a){a.AddRule(this)},d.prototype.AddValidator=function(a){this.Validators[a.tagName]=a,this.ValidationFailures[a.tagName]=new c(new b,!!a.isAsync)},Object.defineProperty(d.prototype,"Errors",{get:function(){return this.ValidationFailures},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"HasErrors",{get:function(){return void 0!==this.Optional&&_.isFunction(this.Optional)&&this.Optional()?!1:_.some(_.values(this.Errors),function(a){return a.HasError})},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"ErrorCount",{get:function(){return this.HasErrors?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"ErrorMessage",{get:function(){return this.HasErrors?_.reduce(_.values(this.Errors),function(a,b){return a+b.ErrorMessage},""):""},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"TranslateArgs",{get:function(){if(!this.HasErrors)return[];var a=[];return _.each(_.values(this.Errors),function(b){b.HasError&&a.push(b.Error.TranslateArgs)}),a},enumerable:!0,configurable:!0}),d.prototype.Validate=function(a){try{return this.ValidateEx(a.Value)}catch(b){throw console.log("Exception occurred when checking element "+a.Key+".",b),b}},d.prototype.ValidateEx=function(a){var b=0,c=!1,d=this.HasErrors;for(var e in this.ValidationFailures){var f=this.ValidationFailures[e];if(!f.IsAsync){var g=this.Validators[e];try{var h=0;if(c&&h>b)f.Error.HasError=!1;else{var i=void 0!==a&&null!==a||"required"==g.tagName?!g.isAcceptable(a):!1;f.Error.HasError=i,f.Error.TranslateArgs={TranslateId:g.tagName,MessageArgs:_.extend(g,{AttemptedValue:a}),CustomMessage:g.customMessage},f.Error.ErrorMessage=i?l.GetValidationMessage(f.Error.TranslateArgs.MessageArgs):"",c=i,b=h}}catch(j){throw console.log("Exception occurred when checking element'"+g.tagName+"' method.",j),j}}}return d!==this.HasErrors&&this.DispatchErrorsChanged(),_.filter(this.ValidationFailures,function(a){return!a.IsAsync})},d.prototype.ValidateAsync=function(a){return this.ValidateAsyncEx(a.Value)},d.prototype.ValidateAsyncEx=function(a){var b=Q.defer(),c=[],d=this.HasErrors,e=function(b){var c=!b;g.Error.HasError=c,g.Error.TranslateArgs={TranslateId:h.tagName,MessageArgs:_.extend(h,{AttemptedValue:a})},g.Error.ErrorMessage=c?l.GetValidationMessage(g.Error.TranslateArgs.MessageArgs):""};for(var f in this.ValidationFailures){var g=this.ValidationFailures[f];if(g.IsAsync){var h=this.Validators[f];try{var i=void 0!==a&&null!==a||"required"==h.tagName?h.isAcceptable(a):Q.when(!0);i.then(e),c.push(i)}catch(j){throw console.log("Exception occurred when checking element'"+h.tagName+"' method.",j),j}}}var k=this;return Q.all(c).then(function(){d!==k.HasErrors&&k.DispatchErrorsChanged(),b.resolve(_.filter(k.ValidationFailures,function(a){return a.IsAsync}))}),b.promise},d}(d),n=function(a){function d(d,e,f){a.call(this,d),this.Name=d,this.ValidateFce=e,this.AsyncValidationFce=f,this.Error=new b,this.ValidationFailures={},this.ValidationFailures[this.Name]=new c(this.Error,!1)}return __extends(d,a),d.prototype.Validate=function(a){var b=this.Error.HasError;return void 0!==this.ValidateFce&&this.ValidateFce.bind(a)(this.Error),b!==this.Error.HasError&&this.DispatchErrorsChanged(),this.ValidationFailures[this.Name]},d.prototype.ValidateAsync=function(a){var b=Q.defer();if(void 0===this.AsyncValidationFce)b.resolve(this.ValidationFailures[this.Name]);else{var c=this.Error.HasError,d=this;this.AsyncValidationFce.bind(a)(this.Error).then(function(){c!==d.Error.HasError&&d.DispatchErrorsChanged(),b.resolve(d.ValidationFailures[d.Name])})}return b.promise},Object.defineProperty(d.prototype,"HasError",{get:function(){return this.HasErrors},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"Errors",{get:function(){return this.ValidationFailures},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"HasErrors",{get:function(){return void 0!==this.Optional&&_.isFunction(this.Optional)&&this.Optional()?!1:this.Error.HasError},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"ErrorCount",{get:function(){return this.HasErrors?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"ErrorMessage",{get:function(){return this.HasErrors?this.Error.ErrorMessage:""},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"TranslateArgs",{get:function(){if(!this.HasErrors)return[];var a=[];return a.push(this.Error.TranslateArgs),a},enumerable:!0,configurable:!0}),d.prototype.AcceptVisitor=function(a){a.AddValidation(this)},d}(d)}(Validation||(Validation={}));var Validators;!function(a){var b=function(){function a(){}return a.GetNegDigits=function(a){if(void 0===a)return 0;var b=a.toString().split(".");return b.length>1?b[1].length:0},a}(),c=function(){function a(){this.lettersRegexp=/^[A-Za-z]+$/,this.tagName="lettersonly"}return a.prototype.isAcceptable=function(a){return this.lettersRegexp.test(a)},a}();a.LettersOnlyValidator=c;var d=function(){function a(){this.numberRegexp=/^[0-9]+$/,this.tagName="zipcode"}return a.prototype.isAcceptable=function(a){return 5===a.length&&this.numberRegexp.test(a)},a}();a.ZipCodeValidator=d;var e=function(){function a(){this.emailRegexp=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,this.tagName="email"}return a.prototype.isAcceptable=function(a){return this.emailRegexp.test(a)},a}();a.EmailValidator=e;var f=function(){function a(){this.urlRegexp=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,this.tagName="url"}return a.prototype.isAcceptable=function(a){return this.urlRegexp.test(a)},a}();a.UrlValidator=f;var g=function(){function a(){this.tagName="creditcard"}return a.prototype.isAcceptable=function(a){if(/[^0-9 \-]+/.test(a))return!1;var b,c,d=0,e=0,f=!1;if(a=a.replace(/\D/g,""),a.length<13||a.length>19)return!1;for(b=a.length-1;b>=0;b--)c=a.charAt(b),e=parseInt(c,10),f&&(e*=2)>9&&(e-=9),d+=e,f=!f;return d%10===0},a}();a.CreditCardValidator=g;var h=function(){function a(){this.tagName="required"}return a.prototype.isAcceptable=function(a){return void 0!==a&&""!==a},a}();a.RequiredValidator=h;var i=function(){function a(a){this.Value=a,this.tagName="equalTo"}return a.prototype.isAcceptable=function(a){return a===this.Value},a}();a.EqualToValidator=i;var j=function(){function a(){this.tagName="date"}return a.prototype.isAcceptable=function(a){return!/Invalid|NaN/.test(new Date(a).toString())},a}();a.DateValidator=j;var k=function(){function a(){this.tagName="dateISO"}return a.prototype.isAcceptable=function(a){return/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(a)},a}();a.DateISOValidator=k;var l=function(){function a(){this.tagName="number"}return a.prototype.isAcceptable=function(a){return/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)},a}();a.NumberValidator=l;var m=function(){function a(){this.tagName="digit"}return a.prototype.isAcceptable=function(a){return/^\d+$/.test(a)},a}();a.DigitValidator=m;var n=function(){function a(){this.tagName="signedDigit"}return a.prototype.isAcceptable=function(a){return/^-?\d+$/.test(a)},a}();a.SignedDigitValidator=n;var o=0,p=function(){function a(a){this.MinLength=a,this.tagName="minlength",void 0===a&&(this.MinLength=o)}return a.prototype.isAcceptable=function(a){return a.length>=this.MinLength},a}();a.MinLengthValidator=p;var q=0,r=function(){function a(a){this.MaxLength=a,this.tagName="maxlength",void 0===a&&(this.MaxLength=q)}return a.prototype.isAcceptable=function(a){return a.length<=this.MaxLength},a}();a.MaxLengthValidator=r;var s=function(){function a(a){this.RangeLength=a,this.tagName="rangelength",void 0===a&&(this.RangeLength=[o,q])}return a.prototype.isAcceptable=function(a){return a.length>=this.MinLength&&a.length<=this.MaxLength},Object.defineProperty(a.prototype,"MinLength",{get:function(){return this.RangeLength[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"MaxLength",{get:function(){return this.RangeLength[1]},enumerable:!0,configurable:!0}),a}();a.RangeLengthValidator=s;var t=function(){function a(a,b){this.Min=a,this.Exclusive=b,this.tagName="min",void 0===a&&(this.Min=o)}return a.prototype.isAcceptable=function(a){return _.isNumber(a)||(a=parseFloat(a)),this.Exclusive?a>this.Min:a>=this.Min},a}();a.MinValidator=t;var u=function(){function a(a){this.Min=a,this.tagName="minItems",void 0===a&&(this.Min=o)}return a.prototype.isAcceptable=function(a){return _.isArray(a)?a.length>=this.Min:!1},a}();a.MinItemsValidator=u;var v=function(){function a(a,b){this.Max=a,this.Exclusive=b,this.tagName="max",void 0===a&&(this.Max=q)}return a.prototype.isAcceptable=function(a){return _.isNumber(a)||(a=parseFloat(a)),this.Exclusive?a<this.Max:a<=this.Max},a}();a.MaxValidator=v;var w=function(){function a(a){this.Max=a,this.tagName="maxItems",void 0===a&&(this.Max=q)}return a.prototype.isAcceptable=function(a){return _.isArray(a)?a.length<=this.Max:!1},a}();a.MaxItemsValidator=w;var x=function(){function a(){this.tagName="uniqItems"}return a.prototype.isAcceptable=function(a){return _.isArray(a)?_.uniq(a).length===a.length:!1},a}();a.UniqItemsValidator=x;var y=function(){function a(a){this.Range=a,this.tagName="range",void 0===a&&(this.Range=[o,q])}return a.prototype.isAcceptable=function(a){return _.isNumber(a)||(a=parseFloat(a)),a.length>=this.Min&&a.length<=this.Max},Object.defineProperty(a.prototype,"Min",{get:function(){return this.Range[0]},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"Max",{get:function(){return this.Range[1]},enumerable:!0,configurable:!0}),a}();a.RangeValidator=y;var z=function(){function a(a){this.Enum=a,this.tagName="enum",void 0===a&&(this.Enum=[])}return a.prototype.isAcceptable=function(a){return _.contains(this.Enum,a)},a}();a.EnumValidator=z;var A=function(){function a(a){this.Type=a,this.tagName="type",void 0===this.Type&&(this.Type="string")}return a.prototype.isAcceptable=function(a){return"string"===this.Type?_.isString(a):"boolean"===this.Type?_.isBoolean(a):"number"===this.Type?_.isNumber(a):"integer"===this.Type?/^\d+$/.test(a):"object"===this.Type?_.isObject(a):"array"===this.Type?_.isArray(a):!1},a}();a.TypeValidator=A;var B=function(){function a(a){this.Step=a,this.StepDefaultValue="1",this.tagName="step",void 0===a&&(this.Step=this.StepDefaultValue)}return a.prototype.isAcceptable=function(a){var c=Math.max(b.GetNegDigits(a),b.GetNegDigits(this.Step)),d=Math.pow(10,c);return parseInt(a,10)*d%(parseInt(this.Step,10)*d)===0},a}();a.StepValidator=B;var C=function(){function a(a){this.Divider=a,this.MultipleOfDefaultValue=1,this.tagName="multipleOf",void 0===a&&(this.Divider=this.MultipleOfDefaultValue)}return a.prototype.isAcceptable=function(a){return _.isNumber(a)?a%this.Divider%1===0:!1},a}();a.MultipleOfValidator=C;var D=function(){function a(a){this.Pattern=a,this.tagName="pattern"}return a.prototype.isAcceptable=function(a){return new RegExp(this.Pattern).test(a)},a}();a.PatternValidator=D;var E=function(){function a(a){this.Options=a,this.isAsync=!0,this.tagName="contains",void 0===a&&(this.Options=Q.when([]))}return a.prototype.isAcceptable=function(a){var b=Q.defer();return this.Options.then(function(c){var d=_.some(c,function(b){return b===a});d&&b.resolve(!0),b.resolve(!1)}),b.promise},a}();a.ContainsValidator=E;var F=function(){function a(a){this.Options=a,this.isAsync=!0,this.tagName="remote"}return a.prototype.isAcceptable=function(a){var b=Q.defer();return this.axios.post(this.Options.url,{method:this.Options.type||"get",data:_.extend({}||this.Options.data,{value:a})}).then(function(a){var c=a===!0||"true"===a;b.resolve(c)}).catch(function(a){b.resolve(!1),console.log(a)}),b.promise},a}();a.RemoteValidator=F}(Validators||(Validators={}));var Utils;!function(a){var b=function(){function a(){}return a.format=function(a,b){var c=a;for(var d in b){var e=new RegExp("\\{"+d+"\\}","gi");c=c.replace(e,b[d])}return c},a}();a.StringFce=b;var c=function(){function a(){}return a.GetNegDigits=function(a){if(void 0===a)return 0;var b=a.toString().split(".");if(b.length>1){var c=b[1].length;return c}return 0},a}();a.NumberFce=c;var d=function(){function a(){this.listeners=[],this.priorities=[]}return a.prototype.add=function(a,b){"undefined"==typeof b&&(b=0);var c=this.listeners.indexOf(a);if(-1!==c)return void(this.priorities[c]=b);for(var d=0,e=this.priorities.length;e>d;d++)if(this.priorities[d]<b)return this.priorities.splice(d,0,b),void this.listeners.splice(d,0,a);this.priorities.push(b),this.listeners.push(a)},a.prototype.remove=function(a){var b=this.listeners.indexOf(a);b>=0&&(this.priorities.splice(b,1),this.listeners.splice(b,1))},a.prototype.dispatch=function(a){var b=this.listeners.every(function(b){var c=b(a);return c!==!1});return b},a.prototype.clear=function(){this.listeners=[],this.priorities=[]},a.prototype.hasListeners=function(){return this.listeners.length>0},a}();a.Signal=d}(Utils||(Utils={}));var FormSchema;!function(a){var b=function(){function a(a){this.jsonSchema=a}return a.prototype.CreateRule=function(a){return this.ParseAbstractRule(this.jsonSchema).CreateRule(a)},a.prototype.ParseAbstractRule=function(a){var b=new Validation.AbstractValidator;for(var c in a){var e=a[c],f=e[d.TYPE_KEY];"object"===f?b.ValidatorFor(c,this.ParseAbstractRule(e[d.PROPERTIES_KEY])):"array"===f?(_.each(this.ParseValidationAttribute(e),function(a){b.RuleFor(c,a)}),b.ValidatorFor(c,this.ParseAbstractRule(e[d.ARRAY_KEY][d.PROPERTIES_KEY]),!0)):_.each(this.ParseValidationAttribute(e),function(a){b.RuleFor(c,a)})}return b},a.prototype.ParseValidationAttribute=function(a){var b=new Array;if(void 0===a)return b;c=a.multipleOf,void 0!==c&&b.push(new Validators.MultipleOfValidator(c)),c=a.maximum,void 0!==c&&b.push(new Validators.MaxValidator(c,a.exclusiveMaximum)),c=a.minimum,void 0!==c&&b.push(new Validators.MinValidator(c,a.exclusiveMinimum)),c=a.maxLength,void 0!==c&&b.push(new Validators.MaxLengthValidator(c)),c=a.minLength,void 0!==c&&b.push(new Validators.MinLengthValidator(c)),c=a.pattern,void 0!==c&&b.push(new Validators.PatternValidator(c)),c=a.minItems,void 0!==c&&b.push(new Validators.MinItemsValidator(c)),c=a.maxItems,void 0!==c&&b.push(new Validators.MaxItemsValidator(c)),c=a.uniqueItems,void 0!==c&&b.push(new Validators.UniqItemsValidator);var c=a.required;void 0!==c&&c&&b.push(new Validators.RequiredValidator),c=a["enum"],void 0!==c&&b.push(new Validators.EnumValidator(c));var c=a.type;return void 0!==c&&b.push(new Validators.TypeValidator(c)),c=a.email,void 0!==c&&b.push(new Validators.EmailValidator),c=a.uri,void 0!==c&&b.push(new Validators.UrlValidator),b},a}();a.JsonSchemaRuleFactory=b;var c=function(){function a(a){this.metaData=a}return a.prototype.CreateRule=function(a){return this.ParseAbstractRule(this.metaData).CreateRule(a)},a.prototype.ParseAbstractRule=function(b){var c=new Validation.AbstractValidator;for(var d in b){var e=b[d],f=e[a.RULES_KEY];_.isArray(e)?(void 0!==e[1]&&_.each(this.ParseValidationAttribute(e[1]),function(a){c.RuleFor(d,a)}),c.ValidatorFor(d,this.ParseAbstractRule(e[0]),!0)):void 0!==f?_.each(this.ParseValidationAttribute(f),function(a){c.RuleFor(d,a)}):c.ValidatorFor(d,this.ParseAbstractRule(e))}return c},a.prototype.ParseValidationAttribute=function(a){var b=new Array;if(void 0===a)return b;var c=a.required;void 0!==c&&c&&b.push(new Validators.RequiredValidator);var c=a.remote;return void 0!==c&&c&&b.push(new Validators.RemoteValidator(c)),c=a.maxlength,void 0!==c&&b.push(new Validators.MaxLengthValidator(c)),c=a.minlength,void 0!==c&&b.push(new Validators.MinLengthValidator(c)),c=a.rangelength,void 0!==c&&b.push(new Validators.RangeLengthValidator(c)),c=a.max,void 0!==c&&b.push(new Validators.MaxValidator(c)),c=a.min,void 0!==c&&b.push(new Validators.MinValidator(c)),c=a.range,void 0!==c&&b.push(new Validators.RangeValidator(c)),c=a.email,void 0!==c&&b.push(new Validators.EmailValidator),c=a.url,void 0!==c&&b.push(new Validators.UrlValidator),c=a.date,void 0!==c&&b.push(new Validators.DateValidator),c=a.dateISO,void 0!==c&&b.push(new Validators.DateISOValidator),c=a.number,void 0!==c&&b.push(new Validators.NumberValidator),c=a.digits,void 0!==c&&b.push(new Validators.DigitValidator),c=a.creditcard,void 0!==c&&b.push(new Validators.CreditCardValidator),c=a.equalTo,void 0!==c&&b.push(new Validators.EqualToValidator(c)),c=a.minItems,void 0!==c&&b.push(new Validators.MinItemsValidator(c)),c=a.maxItems,void 0!==c&&b.push(new Validators.MaxItemsValidator(c)),c=a.uniqueItems,void 0!==c&&b.push(new Validators.UniqItemsValidator),c=a["enum"],void 0!==c&&b.push(new Validators.EnumValidator(c)),b},a.RULES_KEY="rules",a.DEFAULT_KEY="default",a}();a.JQueryValidationRuleFactory=c;var d=function(){function a(){}return a.InitValues=function(b,c){var c=c||{};for(var d in b){var e=b[d],f=e[a.TYPE_KEY];if("object"===f)c[d]={},a.InitValues(e[a.PROPERTIES_KEY],c[d]);else if("array"===f)c[d]=[];else{var g=e[a.DEFAULT_KEY];if(void 0===g)continue;"boolean"===f&&(g="0"===g?!1:!!g),("number"===f||"integer"===f)&&_.isString(g)&&(g.length?isNaN(Number(g))||(g=Number(g)):g=null),"string"===f&&""===g&&(g=null),c[d]=g
}}return c},a.TYPE_KEY="type",a.PROPERTIES_KEY="properties",a.DEFAULT_KEY="default",a.ARRAY_KEY="items",a}();a.Util=d}(FormSchema||(FormSchema={}));